<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="Pragma" content="no-cache" />
<title>YUI3 Events</title>
<style>
#demo div {
    border: 1px solid red;
}
</style>
</head>

<body>

<div id="demo">
    <div class="hd">hd <button id="aa">aa</button></div>
    <div class="bd">bd</div>
    <div class="ft">ft</div>
</div>

<script src="http://yui.yahooapis.com/3.0.0/build/yui/yui-min.js"></script>
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4/jquery.min.js"></script>
<script type="text/javascript">
/*
 this.publish 公佈事件:
    可定義事件的 defaultFn, preventedFn, stoppedFn
    並且可指定是否向上傳遞 emitFacade: true
*/

var cnt = 0;

YUI().use("node", function (Y) {
    console.log("instance 1");
    Y.Global.on("resize", function () {
        console.log("GLOBAL: I know layout resizing...");
    });
});

YUI().use("node", "event", "event-custom", "node-event-simulate", function(Y) {
    console.log("instance 2");

    function UnitPanel() {
        this.on("resize", function (e) {
            Y.log("UnitPanel: Layout! is resizing....", "info", "example");
        });
    }
    Y.augment(UnitPanel, Y.EventTarget);
    p1 = new UnitPanel();

    //有接到 resize 了
    function LayoutUnit(n) {
        this.name = n;
        this.publish("resize", {
            emitFacade: true,
            defaultFn: function() {
                Y.log("LayoutUnit: (df) Layout " + this.name + " is resized.", "info", "example");
            }
        });
        this.on("resize", function (e) {
            Y.log("LayoutUnit: Layout! " + this.name + " is resizing....", "info", "example");
        });
    }
    Y.augment(LayoutUnit, Y.EventTarget);
    u1 = new LayoutUnit('u1');
    u1.addTarget(p1);

    var u2 = new LayoutUnit('u2');

    function Layout() {
        this.publish("resize", {
            broadcast: 2,   //no broadcast
            emitFacade: true,
            defaultFn: function() {
                Y.log("Layout (df) resized", "info", "example");
            }
        });
    }
    Layout.prototype.resize = function (e) {
        Y.log("Layout resizing....", "info", "example");
        this.fire('resize');
    };
    Y.augment(Layout, Y.EventTarget);

    //run
    var layout = new Layout();
    layout.addTarget(u1);
    layout.addTarget(u2);
    Y.on("resize", function (e) {
        layout.resize(e);
    }, window);
    layout.resize();

return;

    var BubbleTarget = function() {
        Y.log("Host constructor executed.", "info", "example");
    }
    Y.augment(BubbleTarget, Y.EventTarget);
    var bubbleTarget = new BubbleTarget();
    bubbleTarget.on("publisher:testEvent", function(e) {
        Y.log("publisher:testEvent fired on the BubbleTarget object.", "info", "example");
    });
    var Publisher = function(bubbleTarget) {
        this.addTarget(bubbleTarget);
        this.publish("publisher:testEvent", {emitFacade: true});
        /*
        this.publish("publisher:testEvent",
            {
                emitFacade: true,
                defaultFn: function() {
                    Y.log("defaultFn: publisher:testEvent's defaultFn executed.", "info", "example");
                },
                preventedFn: function() {
                    Y.log("preventedFn: A subscriber to publisher:testEvent called preventDefault().", "info", "example");
                },
                stoppedFn: function() {
                    Y.log("stoppedFn: A subscriber to publisher:testEvent called stopPropagation().", "info", "example");
                }
            }
        );
        */
        Y.log("Publisher constructor executed.");
    }
    Y.augment(Publisher, Y.EventTarget);
    var p = new Publisher(bubbleTarget);
    p.on("publisher:testEvent", function(e) {
        Y.log("publisher:testEvent subscriber fired on the publisher object.", "info", "example");
        /*
        if(Y.one("#stopPropagation").get("checked")) {
            e.stopPropagation();
        }
        if(Y.one("#preventDefault").get("checked")) {
            e.preventDefault();
        }
        */
    });
    Y.on("click", function(e) {
        //clear out the logger:
        p.fire("publisher:testEvent");
    }, "#demo .bd");


    var bdNode = Y.one(".bd");
    Y.augment(bdNode, Y.EventTarget);
    bdNode.on("walk", function () {
        console.log("bd is walking...");
    });

/*
    //event delegate
    Y.delegate('custom:resize', function (e) {
        Y.log(e.target.get('className')  + ' resized by delegator.');
    }, '#demo', 'div');
    Y.delegate('myclick', function (e) {
        Y.log(e.target.get('className')  + ' myclicked by delegator.');
    }, '#demo', 'div');
*/
    //direct event handler
    bdNode.on("click", function (e) {
        Y.log('body click directly handler');
    });
    Y.one("#aa").on("click", function (e) {
        Y.fireEvent("click", { target: bdNode });
    });

    //這邊用 resize 這個名字不行！ (jQuery 可以)
    /*
    bdNode.on("custom:resize", function () {
        console.log("body resized");
    });
    */
    bdNode.on("mouseenter", function () {
        console.log("body mouseenter");
    });
    Y.augment(bdNode, Y.EventTarget, null, null);



    //window resize
    Y.one(window).on("resize", function () {
        bdNode.simulate("click");
        console.log("window resized");
    });

if(0) {
    //測試 ok 放下面

    //window resize
    Y.one(window).on("resize", function () {
        console.log("window resized");
    });

    //simple custom event:
    // create walk event for .bd, trigger it while #aa clicked
    Y.one("#demo .bd").on("walk", function () {
        console.log("bd is walking...");
    });
    Y.one("#aa").on("click", function () {
        Y.one(".bd").fire("walk");
    });
}
});



</script>
</body>
</html>
